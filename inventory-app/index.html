<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management System - Enhanced</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Barcode Scanner Library -->
    <script src="https://unpkg.com/@zxing/library@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Public+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #141824;
            --bg-tertiary: #1e2433;
            --accent-primary: #00ff87;
            --accent-secondary: #00d4ff;
            --accent-warning: #ffd700;
            --accent-danger: #ff4757;
            --text-primary: #e8eaed;
            --text-secondary: #9aa0ab;
            --text-tertiary: #6b7280;
            --border: #2d3548;
            --shadow: rgba(0, 255, 135, 0.1);
        }

        body {
            font-family: 'Public Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .background-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 135, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 135, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 48px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Public Sans', sans-serif;
            transition: all 0.3s ease;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 255, 135, 0.1);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Public Sans', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: var(--bg-primary);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .btn-danger {
            background: var(--accent-danger);
            color: white;
        }

        .btn-danger:hover {
            background: #e63946;
        }

        .btn-icon {
            padding: 10px 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-link {
            background: none;
            color: var(--accent-primary);
            text-decoration: underline;
            padding: 8px;
            font-size: 14px;
        }

        .btn-success {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        .btn-success:hover {
            background: #00e077;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-right: 2px solid var(--border);
            padding: 24px;
            display: flex;
            flex-direction: column;
            animation: slideInLeft 0.5s ease-out;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 32px;
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
        }

        .nav-menu {
            flex: 1;
        }

        .nav-item {
            padding: 14px 20px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: 2px solid transparent;
        }

        .nav-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--border);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(0, 255, 135, 0.1), rgba(0, 212, 255, 0.1));
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .nav-item.external-link {
            background: var(--bg-tertiary);
            border: 2px solid var(--accent-secondary);
            color: var(--accent-secondary);
        }

        .nav-item.external-link:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--accent-secondary);
            transform: translateX(8px);
        }

        .guide-menu-item {
            padding: 12px 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        .guide-menu-item:last-child {
            border-bottom: none;
        }

        .guide-menu-item:hover {
            background: var(--accent-primary);
            color: var(--bg-primary);
            padding-left: 20px;
        }

        .user-info {
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            border: 2px solid var(--border);
            margin-top: 24px;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 32px;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* Cards */
        .card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            animation: fadeIn 0.6s ease-out;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        /* Stats Cards */
        .stat-card {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            border-color: var(--accent-primary);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg-tertiary);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border);
        }

        td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tbody tr {
            transition: all 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg-tertiary);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-right: 4px;
        }

        .badge-success {
            background: rgba(0, 255, 135, 0.2);
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
        }

        .badge-warning {
            background: rgba(255, 215, 0, 0.2);
            color: var(--accent-warning);
            border: 1px solid var(--accent-warning);
        }

        .badge-danger {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent-danger);
            border: 1px solid var(--accent-danger);
        }

        .badge-info {
            background: rgba(0, 212, 255, 0.2);
            color: var(--accent-secondary);
            border: 1px solid var(--accent-secondary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 32px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.4s ease-out;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--accent-danger);
        }

        /* Alert */
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-warning {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--accent-warning);
            color: var(--accent-warning);
        }

        .alert-danger {
            background: rgba(255, 71, 87, 0.1);
            border-color: var(--accent-danger);
            color: var(--accent-danger);
        }

        .alert-info {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--accent-secondary);
            color: var(--accent-secondary);
        }

        .alert-success {
            background: rgba(0, 255, 135, 0.1);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        /* Scanner Options */
        .scanner-options {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .scanner-btn {
            flex: 1;
            padding: 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .scanner-btn:hover {
            border-color: var(--accent-primary);
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        .scanner-btn.active {
            border-color: var(--accent-primary);
            background: linear-gradient(135deg, rgba(0, 255, 135, 0.1), rgba(0, 212, 255, 0.1));
        }

        .scanner-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .scanner-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Checkbox */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-group:hover {
            background: var(--bg-secondary);
        }

        .checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-primary);
            cursor: pointer;
        }

        /* Action buttons row */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        /* Video for camera scanner */
        #video-preview {
            width: 100%;
            max-width: 500px;
            height: auto;
            border-radius: 8px;
            border: 2px solid var(--accent-primary);
            margin: 20px auto;
            display: block;
        }

        /* Pick List Items */
        .pick-list-item {
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .pick-list-item:hover {
            border-color: var(--accent-primary);
        }

        .pick-list-item.completed {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 135, 0.05);
        }

        .pick-list-item.incomplete {
            border-color: var(--accent-danger);
        }

        .pick-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .pick-item-name {
            font-size: 18px;
            font-weight: 700;
        }

        .pick-item-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 12px;
        }

        .pick-detail {
            display: flex;
            flex-direction: column;
        }

        .pick-detail-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .pick-detail-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            transition: width 0.3s ease;
        }

        /* File upload area */
        .file-upload-area {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .file-upload-area.drag-over {
            border-color: var(--accent-primary);
            background: rgba(0, 255, 135, 0.05);
        }

        /* Print styles */
        @media print {
            .sidebar, .page-header, .btn, .nav-menu {
                display: none !important;
            }
            .content {
                padding: 0;
            }
            .main-layout {
                display: block;
            }
            body {
                background: white;
                color: black;
            }
            .card, .table-container {
                border: 1px solid #ccc;
                page-break-inside: avoid;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .text-center {
            text-align: center;
        }

        .error-message {
            color: var(--accent-danger);
            font-size: 14px;
            margin-top: 8px;
        }

        .success-message {
            color: var(--accent-primary);
            font-size: 14px;
            margin-top: 8px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
            .pick-item-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid var(--border);
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1000;
                max-height: 100vh;
                overflow-y: auto;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .mobile-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 16px 20px;
                background: var(--bg-secondary);
                border-bottom: 2px solid var(--border);
                position: sticky;
                top: 0;
                z-index: 999;
            }

            .mobile-menu-btn {
                background: var(--bg-tertiary);
                border: 2px solid var(--accent-primary);
                color: var(--accent-primary);
                padding: 10px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .mobile-back-btn {
                background: var(--bg-tertiary);
                border: 2px solid var(--accent-secondary);
                color: var(--accent-secondary);
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                display: flex;
                align-items: center;
                gap: 6px;
                margin-bottom: 16px;
            }

            .content {
                padding: 20px;
                margin-top: 60px; /* Account for fixed header */
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .login-box {
                padding: 32px;
            }

            .scanner-options {
                flex-direction: column;
            }

            .pick-item-details {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons .btn {
                width: 100%;
            }

            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .table-container table {
                min-width: 800px;
            }

            .modal {
                width: 95%;
                max-height: 90vh;
                overflow-y: auto;
            }

            .page-title {
                font-size: 24px;
            }

            .card {
                padding: 16px;
            }
        }

        /* Hide mobile elements on desktop */
        @media (min-width: 769px) {
            .mobile-header {
                display: none;
            }
            
            .mobile-back-btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="background-grid"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBS-a3pzozzUEBeFlVQzPs4cD6uNDPzN2c",
            authDomain: "midstateinventory-43f99.firebaseapp.com",
            projectId: "midstateinventory-43f99",
            storageBucket: "midstateinventory-43f99.firebasestorage.app",
            messagingSenderId: "20000371750",
            appId: "1:20000371750:web:e255b4b72661c27c2b62e7",
            measurementId: "G-814FR7GR7T"
        };

        // Initialize Firebase
        let app, auth, db;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();
            
            // Enable offline persistence
            db.enablePersistence()
                .catch((err) => {
                    if (err.code === 'failed-precondition') {
                        console.log('Multiple tabs open');
                    } else if (err.code === 'unimplemented') {
                        console.log('Browser doesn\'t support persistence');
                    }
                });
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        const generateId = () => `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const formatDate = (date) => {
            if (!date) return '';
            const d = date.toDate ? date.toDate() : new Date(date);
            return d.toLocaleString();
        };

        // ============================================
        // BARCODE SCANNER HOOK
        // ============================================
        function useBarcodeScanner(onScan) {
            const [isScanning, setIsScanning] = useState(false);
            const videoRef = useRef(null);
            const codeReaderRef = useRef(null);

            const startCamera = async () => {
                try {
                    setIsScanning(true);
                    const codeReader = new ZXing.BrowserMultiFormatReader();
                    codeReaderRef.current = codeReader;

                    const videoInputDevices = await codeReader.listVideoInputDevices();
                    
                    if (videoInputDevices.length > 0) {
                        // Try to find the rear/back camera
                        // Back cameras typically have labels containing: "back", "rear", or "environment"
                        let selectedDeviceId = videoInputDevices[0].deviceId;
                        
                        const backCamera = videoInputDevices.find(device => {
                            const label = device.label.toLowerCase();
                            return label.includes('back') || 
                                   label.includes('rear') || 
                                   label.includes('environment') ||
                                   label.includes('facing back');
                        });
                        
                        // If we found a back camera, use it; otherwise use the last camera (often back on mobile)
                        if (backCamera) {
                            selectedDeviceId = backCamera.deviceId;
                        } else if (videoInputDevices.length > 1) {
                            // On mobile devices, the back camera is usually the last in the list
                            selectedDeviceId = videoInputDevices[videoInputDevices.length - 1].deviceId;
                        }
                        
                        await codeReader.decodeFromVideoDevice(
                            selectedDeviceId,
                            videoRef.current,
                            (result, err) => {
                                if (result) {
                                    onScan(result.text);
                                }
                            }
                        );
                    }
                } catch (error) {
                    console.error('Camera error:', error);
                    alert('Unable to access camera. Please check permissions.');
                    setIsScanning(false);
                }
            };

            const stopCamera = () => {
                if (codeReaderRef.current) {
                    codeReaderRef.current.reset();
                }
                setIsScanning(false);
            };

            return { isScanning, startCamera, stopCamera, videoRef };
        }

        // ============================================
        // AUTHENTICATION COMPONENT
        // ============================================
        function AuthScreen({ onAuthSuccess }) {
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [displayName, setDisplayName] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    if (isLogin) {
                        const result = await auth.signInWithEmailAndPassword(email, password);
                        
                        // Check if user has a display name, if not, prompt for it
                        if (!result.user.displayName) {
                            const userName = prompt('Welcome! Please enter your full name for activity logs:');
                            if (userName && userName.trim()) {
                                await result.user.updateProfile({
                                    displayName: userName.trim()
                                });
                                // Also save to users collection
                                await db.collection('users').doc(result.user.uid).set({
                                    email: email,
                                    displayName: userName.trim(),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                }, { merge: true });
                            }
                        }
                    } else {
                        if (!displayName.trim()) {
                            setError('Please enter your full name');
                            setLoading(false);
                            return;
                        }
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        
                        await userCredential.user.updateProfile({
                            displayName: displayName
                        });

                        await db.collection('users').doc(userCredential.user.uid).set({
                            email: email,
                            displayName: displayName,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                    onAuthSuccess();
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="login-screen">
                    <div className="login-box">
                        <div className="login-header">
                            <img 
                                src="https://midstateplumbing.com/wp-content/uploads/2025/01/LO.webp" 
                                alt="Logo" 
                                style={{
                                    maxWidth: '200px',
                                    height: 'auto',
                                    marginBottom: '20px'
                                }}
                            />
                            <p>Inventory Management System</p>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Email</label>
                                <input
                                    type="email"
                                    className="form-input"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    placeholder="your@email.com"
                                    required
                                    autoFocus
                                />
                            </div>
                            <div className="form-group">
                                <label className="form-label">Password</label>
                                <input
                                    type="password"
                                    className="form-input"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Enter password"
                                    required
                                    minLength="6"
                                />
                            </div>
                            {!isLogin && (
                                <div className="form-group">
                                    <label className="form-label">Full Name</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={displayName}
                                        onChange={(e) => setDisplayName(e.target.value)}
                                        placeholder="Enter your full name"
                                        required
                                    />
                                </div>
                            )}
                            {error && <div className="error-message">{error}</div>}
                            <button type="submit" className="btn btn-primary" disabled={loading}>
                                {loading ? 'Processing...' : (isLogin ? 'Login' : 'Create Account')}
                            </button>
                            <button
                                type="button"
                                className="btn btn-link"
                                onClick={() => {
                                    setIsLogin(!isLogin);
                                    setError('');
                                }}
                                style={{ width: '100%', marginTop: '16px' }}
                            >
                                {isLogin ? 'Need an account? Sign up' : 'Already have an account? Login'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // ============================================
        // DASHBOARD COMPONENT
        // ============================================
        function Dashboard({ inventory, pickOrders }) {
            const totalItems = inventory.length;
            const totalValue = inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0);
            const lowStock = inventory.filter(item => item.quantity <= item.reorderPoint).length;
            const missingParts = inventory.filter(item => item.hasMissingParts).length;
            const activePicks = pickOrders.filter(order => order.status !== 'completed').length;

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Dashboard</h1>
                        <p className="page-subtitle">Overview of your inventory system</p>
                    </div>

                    <div className="grid grid-4">
                        <div className="stat-card">
                            <div className="stat-value">{totalItems}</div>
                            <div className="stat-label">Total Items</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">${totalValue.toFixed(2)}</div>
                            <div className="stat-label">Total Value</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{lowStock}</div>
                            <div className="stat-label">Low Stock Alerts</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{activePicks}</div>
                            <div className="stat-label">Active Pick Orders</div>
                        </div>
                    </div>

                    {lowStock > 0 && (
                        <div className="alert alert-warning">
                            <strong>‚ö† Low Stock Alert:</strong> {lowStock} item(s) need reordering.
                        </div>
                    )}

                    {missingParts > 0 && (
                        <div className="alert alert-danger">
                            <strong>üî¥ Missing Parts:</strong> {missingParts} item(s) have missing parts.
                        </div>
                    )}

                    <div className="card">
                        <div className="card-header">
                            <h2 className="card-title">Recent Activity</h2>
                        </div>
                        <div className="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Action</th>
                                        <th>Quantity</th>
                                        <th>Date</th>
                                        <th>User</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {inventory.slice(-5).reverse().map((item) => (
                                        <tr key={item.id}>
                                            <td>{item.name}</td>
                                            <td><span className="badge badge-info">Added</span></td>
                                            <td>{item.quantity}</td>
                                            <td>{formatDate(item.timestamp)}</td>
                                            <td>{item.pickedBy}</td>
                                        </tr>
                                    ))}
                                    {inventory.length === 0 && (
                                        <tr>
                                            <td colSpan="5" style={{textAlign: 'center', color: 'var(--text-secondary)'}}>
                                                No activity yet
                                            </td>
                                        </tr>
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================
        // STOCK/PICK COMPONENT WITH SCANNER
        // ============================================
        function StockPick({ onAddItem, onPickItem, inventory, currentUser }) {
            const [mode, setMode] = useState('stock');
            const [scannerType, setScannerType] = useState('manual');
            const [loading, setLoading] = useState(false);
            const [message, setMessage] = useState('');
            const [scannedCode, setScannedCode] = useState('');
            const [formData, setFormData] = useState({
                name: '',
                brand: '',
                model: '',
                serial: '',
                style: '',
                size: '',
                department: '',
                location: '',
                binLocation: '',
                quantity: '',
                price: '',
                reorderPoint: '',
                hasMissingParts: false,
                missingPartsNotes: ''
            });

            const { isScanning, startCamera, stopCamera, videoRef } = useBarcodeScanner((code) => {
                setScannedCode(code);
                setFormData(prev => ({ ...prev, serial: code }));
                setMessage(`‚úì Scanned: ${code}`);
                stopCamera();
            });

            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;
                setFormData(prev => ({
                    ...prev,
                    [name]: type === 'checkbox' ? checked : value
                }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                setMessage('');

                try {
                    if (mode === 'stock') {
                        const item = {
                            ...formData,
                            quantity: parseInt(formData.quantity) || 0,
                            price: parseFloat(formData.price) || 0,
                            reorderPoint: parseInt(formData.reorderPoint) || 10,
                            pickedBy: currentUser.displayName,
                            pickedByUid: currentUser.uid,
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            scannerType,
                            mode: 'stock'
                        };
                        await onAddItem(item);
                        setMessage(`‚úì Item "${formData.name}" added to stock!`);
                    } else {
                        // Pick mode - reduce quantity from inventory
                        const existingItem = inventory.find(item => 
                            item.serial === formData.serial || item.name === formData.name
                        );

                        if (existingItem) {
                            const pickQty = parseInt(formData.quantity) || 0;
                            if (existingItem.quantity >= pickQty) {
                                await onPickItem(existingItem.id, pickQty, currentUser);
                                setMessage(`‚úì Picked ${pickQty} of "${existingItem.name}"`);
                            } else {
                                setMessage(`Error: Only ${existingItem.quantity} available in stock`);
                            }
                        } else {
                            setMessage('Error: Item not found in inventory');
                        }
                    }
                    
                    setFormData({
                        name: '',
                        brand: '',
                        model: '',
                        serial: '',
                        style: '',
                        size: '',
                        department: '',
                        location: '',
                        binLocation: '',
                        quantity: '',
                        price: '',
                        reorderPoint: '',
                        hasMissingParts: false,
                        missingPartsNotes: ''
                    });
                    setScannedCode('');
                } catch (error) {
                    setMessage(`Error: ${error.message}`);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Stock / Pick Items</h1>
                        <p className="page-subtitle">Add to stock or pick from inventory</p>
                    </div>

                    {message && (
                        <div className={`alert ${message.includes('Error') ? 'alert-danger' : 'alert-success'}`}>
                            {message}
                        </div>
                    )}

                    <div className="card">
                        <div className="card-header">
                            <h2 className="card-title">Mode Selection</h2>
                        </div>
                        <div className="scanner-options">
                            <div 
                                className={`scanner-btn ${mode === 'stock' ? 'active' : ''}`}
                                onClick={() => setMode('stock')}
                            >
                                <div className="scanner-icon">üì¶</div>
                                <div className="scanner-label">Stock Mode</div>
                                <div style={{fontSize: '12px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    Add items to inventory
                                </div>
                            </div>
                            <div 
                                className={`scanner-btn ${mode === 'pick' ? 'active' : ''}`}
                                onClick={() => setMode('pick')}
                            >
                                <div className="scanner-icon">üéØ</div>
                                <div className="scanner-label">Pick Mode</div>
                                <div style={{fontSize: '12px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    Remove items from inventory
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="card">
                        <div className="card-header">
                            <h2 className="card-title">Scanner Type</h2>
                        </div>
                        <div className="scanner-options">
                            <div 
                                className={`scanner-btn ${scannerType === 'manual' ? 'active' : ''}`}
                                onClick={() => setScannerType('manual')}
                            >
                                <div className="scanner-icon">‚å®Ô∏è</div>
                                <div className="scanner-label">Manual Entry</div>
                            </div>
                            <div 
                                className={`scanner-btn ${scannerType === 'usb' ? 'active' : ''}`}
                                onClick={() => setScannerType('usb')}
                            >
                                <div className="scanner-icon">üîå</div>
                                <div className="scanner-label">USB Scanner</div>
                                <div style={{fontSize: '11px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    Wired barcode scanner
                                </div>
                            </div>
                            <div 
                                className={`scanner-btn ${scannerType === 'bluetooth' ? 'active' : ''}`}
                                onClick={() => setScannerType('bluetooth')}
                            >
                                <div className="scanner-icon">üì±</div>
                                <div className="scanner-label">Bluetooth Scanner</div>
                                <div style={{fontSize: '11px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    iOS/Android compatible
                                </div>
                            </div>
                            <div 
                                className={`scanner-btn ${scannerType === 'wifi' ? 'active' : ''}`}
                                onClick={() => setScannerType('wifi')}
                            >
                                <div className="scanner-icon">üì°</div>
                                <div className="scanner-label">WiFi Scanner</div>
                                <div style={{fontSize: '11px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    Network-based scanning
                                </div>
                            </div>
                            <div 
                                className={`scanner-btn ${scannerType === 'camera' ? 'active' : ''}`}
                                onClick={() => setScannerType('camera')}
                            >
                                <div className="scanner-icon">üì∑</div>
                                <div className="scanner-label">Camera Scanner</div>
                                <div style={{fontSize: '11px', marginTop: '4px', color: 'var(--text-secondary)'}}>
                                    Built-in camera barcode scan
                                </div>
                            </div>
                        </div>
                        
                        {scannerType === 'camera' && (
                            <div style={{marginTop: '20px'}}>
                                {!isScanning ? (
                                    <button className="btn btn-success" onClick={startCamera}>
                                        üì∑ Start Camera Scanner
                                    </button>
                                ) : (
                                    <>
                                        <video ref={videoRef} id="video-preview" autoPlay></video>
                                        <button className="btn btn-danger" onClick={stopCamera}>
                                            Stop Camera
                                        </button>
                                    </>
                                )}
                                {scannedCode && (
                                    <div className="alert alert-success" style={{marginTop: '16px'}}>
                                        <strong>Scanned Code:</strong> {scannedCode}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {scannerType === 'usb' && (
                            <div className="alert alert-info" style={{marginTop: '16px'}}>
                                <strong>USB Scanner Ready:</strong> Simply plug your USB barcode scanner into your computer. 
                                Click in the Serial # field and scan - barcodes will automatically appear as you scan!
                                <div style={{marginTop: '8px', fontSize: '12px'}}>
                                    ‚úì Works with any USB HID scanner<br/>
                                    ‚úì No drivers needed<br/>
                                    ‚úì Plug and play
                                </div>
                            </div>
                        )}
                        
                        {(scannerType === 'bluetooth' || scannerType === 'wifi') && (
                            <div className="alert alert-info" style={{marginTop: '16px'}}>
                                <strong>Scanner Ready:</strong> Connect your {scannerType.toUpperCase()} scanner to your device (iOS/Android/Windows). 
                                The scanner will automatically input barcodes into the Serial # field when in focus.
                            </div>
                        )}
                    </div>

                    <div className="card">
                        <div className="card-header">
                            <h2 className="card-title">Item Details</h2>
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="grid grid-2">
                                <div className="form-group">
                                    <label className="form-label">Item Name *</label>
                                    <input
                                        type="text"
                                        name="name"
                                        className="form-input"
                                        value={formData.name}
                                        onChange={handleInputChange}
                                        required
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Brand</label>
                                    <input
                                        type="text"
                                        name="brand"
                                        className="form-input"
                                        value={formData.brand}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Model #</label>
                                    <input
                                        type="text"
                                        name="model"
                                        className="form-input"
                                        value={formData.model}
                                        onChange={handleInputChange}
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Serial # / Barcode</label>
                                    <input
                                        type="text"
                                        name="serial"
                                        className="form-input"
                                        value={formData.serial}
                                        onChange={handleInputChange}
                                        placeholder="Scan or enter manually"
                                    />
                                </div>
                                {mode === 'stock' && (
                                    <>
                                        <div className="form-group">
                                            <label className="form-label">Style</label>
                                            <input
                                                type="text"
                                                name="style"
                                                className="form-input"
                                                value={formData.style}
                                                onChange={handleInputChange}
                                                placeholder="Color, Type, etc."
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Size</label>
                                            <input
                                                type="text"
                                                name="size"
                                                className="form-input"
                                                value={formData.size}
                                                onChange={handleInputChange}
                                                placeholder="Small, Large, 12in, etc."
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Department</label>
                                            <input
                                                type="text"
                                                name="department"
                                                className="form-input"
                                                value={formData.department}
                                                onChange={handleInputChange}
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Location *</label>
                                            <input
                                                type="text"
                                                name="location"
                                                className="form-input"
                                                value={formData.location}
                                                onChange={handleInputChange}
                                                required
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Unit Price ($)</label>
                                            <input
                                                type="number"
                                                name="price"
                                                className="form-input"
                                                value={formData.price}
                                                onChange={handleInputChange}
                                                min="0"
                                                step="0.01"
                                            />
                                        </div>
                                        <div className="form-group">
                                            <label className="form-label">Reorder Point</label>
                                            <input
                                                type="number"
                                                name="reorderPoint"
                                                className="form-input"
                                                value={formData.reorderPoint}
                                                onChange={handleInputChange}
                                                min="0"
                                                placeholder="10"
                                            />
                                        </div>
                                    </>
                                )}
                                <div className="form-group">
                                    <label className="form-label">Quantity *</label>
                                    <input
                                        type="number"
                                        name="quantity"
                                        className="form-input"
                                        value={formData.quantity}
                                        onChange={handleInputChange}
                                        min="0"
                                        required
                                    />
                                </div>
                            </div>

                            {mode === 'stock' && (
                                <>
                                    <div className="form-group">
                                        <div className="checkbox-group">
                                            <input
                                                type="checkbox"
                                                name="hasMissingParts"
                                                className="checkbox"
                                                checked={formData.hasMissingParts}
                                                onChange={handleInputChange}
                                            />
                                            <label className="form-label" style={{margin: 0}}>Has Missing Parts</label>
                                        </div>
                                    </div>

                                    {formData.hasMissingParts && (
                                        <div className="form-group">
                                            <label className="form-label">Missing Parts Notes</label>
                                            <textarea
                                                name="missingPartsNotes"
                                                className="form-input"
                                                value={formData.missingPartsNotes}
                                                onChange={handleInputChange}
                                                rows="3"
                                                placeholder="Describe missing parts..."
                                            />
                                        </div>
                                    )}
                                </>
                            )}

                            <div className="action-buttons">
                                <button type="submit" className="btn btn-primary" disabled={loading}>
                                    {loading ? 'Processing...' : (mode === 'stock' ? 'üì¶ Add to Stock' : 'üéØ Pick Item')}
                                </button>
                                <button type="button" className="btn btn-secondary" onClick={() => {
                                    setFormData({
                                        name: '',
                                        brand: '',
                                        model: '',
                                        serial: '',
                                        style: '',
                                        department: '',
                                        location: '',
                                        quantity: '',
                                        price: '',
                                        reorderPoint: '',
                                        hasMissingParts: false,
                                        missingPartsNotes: ''
                                    });
                                    setMessage('');
                                    setScannedCode('');
                                }}>
                                    Clear Form
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

        // ============================================
        // BULK PICK ORDERS COMPONENT
        // ============================================
        function BulkPickOrders({ inventory, onCreateOrder, pickOrders, onUpdatePickOrder, currentUser }) {
            const [orderName, setOrderName] = useState('');
            const [orderAddress, setOrderAddress] = useState('');
            const [orderPO, setOrderPO] = useState('');
            const [orderContact, setOrderContact] = useState('');
            const [uploadedItems, setUploadedItems] = useState([]);
            const [selectedOrder, setSelectedOrder] = useState(null);
            const [activeTab, setActiveTab] = useState('create'); // 'create' or 'active'

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const text = event.target.result;
                        const lines = text.split('\n');
                        const items = [];

                        // Skip header row, parse CSV
                        for (let i = 1; i < lines.length; i++) {
                            const line = lines[i].trim();
                            if (!line) continue;

                            const parts = line.split(',');
                            if (parts.length >= 2) {
                                const itemName = parts[0].trim();
                                const quantityNeeded = parseInt(parts[1].trim()) || 0;
                                
                                // Find in inventory
                                const inventoryItem = inventory.find(item => 
                                    item.name.toLowerCase() === itemName.toLowerCase() ||
                                    item.serial === itemName
                                );

                                items.push({
                                    id: generateId(),
                                    name: itemName,
                                    quantityNeeded,
                                    quantityPicked: 0,
                                    inventoryItem: inventoryItem || null,
                                    status: inventoryItem ? 'pending' : 'not_found'
                                });
                            }
                        }

                        setUploadedItems(items);
                    } catch (error) {
                        alert('Error parsing file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };

            const handleTextAreaParse = (text) => {
                const lines = text.split('\n');
                const items = [];

                for (let line of lines) {
                    line = line.trim();
                    if (!line) continue;

                    const parts = line.split(',');
                    if (parts.length >= 2) {
                        const itemName = parts[0].trim();
                        const quantityNeeded = parseInt(parts[1].trim()) || 0;
                        
                        const inventoryItem = inventory.find(item => 
                            item.name.toLowerCase() === itemName.toLowerCase() ||
                            item.serial === itemName
                        );

                        items.push({
                            id: generateId(),
                            name: itemName,
                            quantityNeeded,
                            quantityPicked: 0,
                            inventoryItem: inventoryItem || null,
                            status: inventoryItem ? 'pending' : 'not_found'
                        });
                    }
                }

                setUploadedItems(items);
            };

            const handleCreateOrder = async () => {
                if (!orderName.trim()) {
                    alert('Please enter an order name');
                    return;
                }
                if (uploadedItems.length === 0) {
                    alert('Please add items to the order');
                    return;
                }

                const order = {
                    name: orderName,
                    address: orderAddress,
                    poNumber: orderPO,
                    contact: orderContact,
                    items: uploadedItems,
                    createdBy: currentUser.displayName,
                    createdByUid: currentUser.uid,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    status: 'active',
                    completedAt: null
                };

                await onCreateOrder(order);
                setOrderName('');
                setOrderAddress('');
                setOrderPO('');
                setOrderContact('');
                setUploadedItems([]);
                setActiveTab('active');
            };

            const handlePickItem = async (orderId, itemId, quantity) => {
                await onUpdatePickOrder(orderId, itemId, quantity);
            };

            const calculateOrderProgress = (order) => {
                const totalItems = order.items.length;
                const completedItems = order.items.filter(item => 
                    item.quantityPicked >= item.quantityNeeded
                ).length;
                return (completedItems / totalItems) * 100;
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Bulk Pick Orders</h1>
                        <p className="page-subtitle">Manage multi-item pick lists and fulfillment</p>
                    </div>

                    <div className="card">
                        <div className="scanner-options">
                            <div 
                                className={`scanner-btn ${activeTab === 'create' ? 'active' : ''}`}
                                onClick={() => setActiveTab('create')}
                            >
                                <div className="scanner-icon">‚ûï</div>
                                <div className="scanner-label">Create Order</div>
                            </div>
                            <div 
                                className={`scanner-btn ${activeTab === 'active' ? 'active' : ''}`}
                                onClick={() => setActiveTab('active')}
                            >
                                <div className="scanner-icon">üìã</div>
                                <div className="scanner-label">Active Orders ({pickOrders.filter(o => o.status !== 'completed').length})</div>
                            </div>
                        </div>
                    </div>

                    {activeTab === 'create' && (
                        <>
                            <div className="card">
                                <div className="card-header">
                                    <h2 className="card-title">Order Details</h2>
                                </div>
                                <div className="grid grid-2">
                                    <div className="form-group">
                                        <label className="form-label">Order Name *</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={orderName}
                                            onChange={(e) => setOrderName(e.target.value)}
                                            placeholder="e.g., Customer Order #1234"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">PO Number</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={orderPO}
                                            onChange={(e) => setOrderPO(e.target.value)}
                                            placeholder="Purchase Order #"
                                        />
                                    </div>
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Shipping Address</label>
                                    <textarea
                                        className="form-textarea"
                                        value={orderAddress}
                                        onChange={(e) => setOrderAddress(e.target.value)}
                                        placeholder="Street address, City, State, ZIP"
                                        rows="3"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">Contact Information</label>
                                    <input
                                        type="text"
                                        className="form-input"
                                        value={orderContact}
                                        onChange={(e) => setOrderContact(e.target.value)}
                                        placeholder="Name, Phone, Email"
                                    />
                                </div>
                            </div>

                            <div className="card">
                                <div className="card-header">
                                    <h2 className="card-title">Upload Pick List</h2>
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">CSV File Upload</label>
                                    <div className="file-upload-area">
                                        <input
                                            type="file"
                                            accept=".csv,.txt"
                                            onChange={handleFileUpload}
                                            style={{display: 'none'}}
                                            id="file-upload"
                                        />
                                        <label htmlFor="file-upload" style={{cursor: 'pointer'}}>
                                            <div style={{fontSize: '48px', marginBottom: '12px'}}>üìÅ</div>
                                            <div style={{fontSize: '16px', fontWeight: 600}}>
                                                Click to upload CSV file
                                            </div>
                                            <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginTop: '8px'}}>
                                                Format: ItemName, Quantity
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div style={{textAlign: 'center', margin: '20px 0', color: 'var(--text-secondary)'}}>
                                    ‚Äî OR ‚Äî
                                </div>

                                <div className="form-group">
                                    <label className="form-label">Paste Pick List</label>
                                    <textarea
                                        className="form-textarea"
                                        placeholder="Paste your pick list here (one item per line)&#10;Format: ItemName, Quantity&#10;Example:&#10;Widget A, 5&#10;Gadget B, 10"
                                        rows="8"
                                        onChange={(e) => handleTextAreaParse(e.target.value)}
                                    />
                                </div>
                            </div>

                            {uploadedItems.length > 0 && (
                                <div className="card">
                                    <div className="card-header">
                                        <h2 className="card-title">Items to Pick ({uploadedItems.length})</h2>
                                    </div>
                                    {uploadedItems.map((item, index) => (
                                        <div key={item.id} className={`pick-list-item ${item.status === 'not_found' ? 'incomplete' : ''}`}>
                                            <div className="pick-item-header">
                                                <div className="pick-item-name">{item.name}</div>
                                                {item.status === 'not_found' ? (
                                                    <span className="badge badge-danger">Not Found in Inventory</span>
                                                ) : (
                                                    <span className="badge badge-info">Ready to Pick</span>
                                                )}
                                            </div>
                                            <div className="pick-item-details">
                                                <div className="pick-detail">
                                                    <div className="pick-detail-label">Quantity Needed</div>
                                                    <div className="pick-detail-value">{item.quantityNeeded}</div>
                                                </div>
                                                {item.inventoryItem && (
                                                    <>
                                                        <div className="pick-detail">
                                                            <div className="pick-detail-label">Available</div>
                                                            <div className="pick-detail-value">
                                                                {item.inventoryItem.quantity}
                                                            </div>
                                                        </div>
                                                        <div className="pick-detail">
                                                            <div className="pick-detail-label">Location</div>
                                                            <div className="pick-detail-value">
                                                                {item.inventoryItem.location}
                                                            </div>
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    <button className="btn btn-primary" onClick={handleCreateOrder}>
                                        ‚úì Create Pick Order
                                    </button>
                                </div>
                            )}
                        </>
                    )}

                    {activeTab === 'active' && (
                        <div>
                            {pickOrders.filter(order => order.status !== 'completed').map(order => {
                                const progress = calculateOrderProgress(order);
                                const isComplete = progress === 100;

                                return (
                                    <div key={order.id} className="card">
                                        <div className="card-header">
                                            <div>
                                                <h2 className="card-title">{order.name}</h2>
                                                <div style={{fontSize: '12px', color: 'var(--text-secondary)', marginTop: '4px'}}>
                                                    Created by {order.createdBy} ‚Ä¢ {formatDate(order.createdAt)}
                                                </div>
                                                {order.poNumber && (
                                                    <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '8px'}}>
                                                        <strong>PO #:</strong> {order.poNumber}
                                                    </div>
                                                )}
                                                {order.address && (
                                                    <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '4px'}}>
                                                        <strong>Ship To:</strong> {order.address}
                                                    </div>
                                                )}
                                                {order.contact && (
                                                    <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '4px'}}>
                                                        <strong>Contact:</strong> {order.contact}
                                                    </div>
                                                )}
                                            </div>
                                            {isComplete && (
                                                <button 
                                                    className="btn btn-success"
                                                    onClick={async () => {
                                                        await db.collection('pickOrders').doc(order.id).update({
                                                            status: 'completed',
                                                            completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                                                            completedBy: currentUser.displayName
                                                        });
                                                        alert('‚úì Order marked as complete!');
                                                    }}
                                                >
                                                    ‚úì Complete Order
                                                </button>
                                            )}
                                        </div>

                                        <div style={{marginBottom: '20px'}}>
                                            <div style={{display: 'flex', justifyContent: 'space-between', marginBottom: '8px'}}>
                                                <span>Progress</span>
                                                <span>{progress.toFixed(0)}%</span>
                                            </div>
                                            <div className="progress-bar">
                                                <div className="progress-fill" style={{width: `${progress}%`}}></div>
                                            </div>
                                        </div>

                                        {order.items.map(item => {
                                            const isItemComplete = item.quantityPicked >= item.quantityNeeded;
                                            const canPick = item.inventoryItem && 
                                                          item.inventoryItem.quantity > 0 && 
                                                          item.quantityPicked < item.quantityNeeded;

                                            return (
                                                <div 
                                                    key={item.id} 
                                                    className={`pick-list-item ${isItemComplete ? 'completed' : ''} ${!item.inventoryItem ? 'incomplete' : ''}`}
                                                >
                                                    <div className="pick-item-header">
                                                        <div className="pick-item-name">{item.name}</div>
                                                        {isItemComplete ? (
                                                            <span className="badge badge-success">‚úì Complete</span>
                                                        ) : item.inventoryItem ? (
                                                            <span className="badge badge-warning">Picking</span>
                                                        ) : (
                                                            <span className="badge badge-danger">Not Found</span>
                                                        )}
                                                    </div>
                                                    <div className="pick-item-details">
                                                        <div className="pick-detail">
                                                            <div className="pick-detail-label">Needed</div>
                                                            <div className="pick-detail-value">{item.quantityNeeded}</div>
                                                        </div>
                                                        <div className="pick-detail">
                                                            <div className="pick-detail-label">Picked</div>
                                                            <div className="pick-detail-value">{item.quantityPicked}</div>
                                                        </div>
                                                        <div className="pick-detail">
                                                            <div className="pick-detail-label">Remaining</div>
                                                            <div className="pick-detail-value">
                                                                {Math.max(0, item.quantityNeeded - item.quantityPicked)}
                                                            </div>
                                                        </div>
                                                        {item.inventoryItem && (
                                                            <>
                                                                <div className="pick-detail">
                                                                    <div className="pick-detail-label">Available</div>
                                                                    <div className="pick-detail-value">
                                                                        {item.inventoryItem.quantity}
                                                                    </div>
                                                                </div>
                                                                <div className="pick-detail">
                                                                    <div className="pick-detail-label">Location</div>
                                                                    <div className="pick-detail-value">
                                                                        {item.inventoryItem.location}
                                                                    </div>
                                                                </div>
                                                            </>
                                                        )}
                                                    </div>
                                                    {canPick && (
                                                        <button 
                                                            className="btn btn-primary btn-icon"
                                                            style={{marginTop: '12px'}}
                                                            onClick={() => handlePickItem(order.id, item.id, 1)}
                                                        >
                                                            ‚ûï Pick 1
                                                        </button>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                );
                            })}

                            {pickOrders.filter(o => o.status !== 'completed').length === 0 && (
                                <div className="card">
                                    <div style={{textAlign: 'center', padding: '40px', color: 'var(--text-secondary)'}}>
                                        <div style={{fontSize: '48px', marginBottom: '16px'}}>üìã</div>
                                        <div>No active pick orders</div>
                                        <button 
                                            className="btn btn-primary"
                                            style={{marginTop: '20px'}}
                                            onClick={() => setActiveTab('create')}
                                        >
                                            Create New Order
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // ============================================
        // INVENTORY COMPONENT (abbreviated for space)
        // ============================================
        function Inventory({ inventory, onUpdateItem, onDeleteItem }) {
            const [searchTerm, setSearchTerm] = useState('');
            const [editingItem, setEditingItem] = useState(null);
            const [originalSerial, setOriginalSerial] = useState('');

            const filteredInventory = inventory.filter(item =>
                item.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.brand?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.location?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.serial?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                item.department?.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const handleEdit = (item) => {
                setEditingItem({...item});
                setOriginalSerial(item.serial);
            };

            const printSingleLabel = (item) => {
                const printWindow = window.open('', '', 'width=800,height=600');
                
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Print Label - ${item.serial}</title>
                        <scr` + `ipt src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></scr` + `ipt>
                        <style>
                            @page { margin: 0.5in 0.1875in; size: 8.5in 11in; }
                            * { margin: 0; padding: 0; box-sizing: border-box; }
                            body { 
                                font-family: Arial, sans-serif;
                                background: white;
                            }
                            .label-container {
                                width: 2.625in;
                                height: 1in;
                                border: 1px solid #ccc;
                                padding: 0.08in;
                                display: flex;
                                flex-direction: column;
                                justify-content: center;
                                align-items: center;
                                text-align: center;
                                page-break-inside: avoid;
                                margin: 0.25in auto;
                            }
                            .label-name { 
                                font-size: 9pt;
                                font-weight: bold;
                                margin-bottom: 2px;
                                max-height: 18px;
                                overflow: hidden;
                            }
                            .label-location { 
                                font-size: 6pt;
                                color: #666;
                                margin-top: 2px;
                            }
                            @media print {
                                body { margin: 0; }
                                .label-container { border: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="label-container">
                            <div class="label-name">${item.name || ''}</div>
                            <svg id="barcode"></svg>
                            <div class="label-location">${item.location || ''} ${item.binLocation ? '- ' + item.binLocation : ''}</div>
                        </div>
                        <scr` + `ipt>
                            JsBarcode("#barcode", "${item.serial}", {
                                format: "CODE128",
                                width: 2,
                                height: 40,
                                fontSize: 10,
                                displayValue: true
                            });
                            setTimeout(() => {
                                window.print();
                                setTimeout(() => window.close(), 100);
                            }, 500);
                        </scr` + `ipt>
                    </body>
                    </html>
                `);
                
                printWindow.document.close();
            };

            const checkSerialExists = async (serial) => {
                if (serial === originalSerial) return false; // Same serial is okay
                
                const snapshot = await db.collection('inventory')
                    .where('serial', '==', serial)
                    .get();
                
                return !snapshot.empty;
            };

            const handleSaveEdit = async () => {
                // Check if serial was changed and if it's a duplicate
                if (editingItem.serial !== originalSerial) {
                    const exists = await checkSerialExists(editingItem.serial);
                    if (exists) {
                        alert(`Serial number "${editingItem.serial}" already exists! Please use a different serial number.`);
                        return;
                    }
                }
                
                await onUpdateItem(editingItem);
                setEditingItem(null);
                setOriginalSerial('');
            };

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Inventory</h1>
                        <p className="page-subtitle">Manage all inventory items</p>
                    </div>

                    <div className="card">
                        <div className="form-group">
                            <label className="form-label">Search Inventory</label>
                            <input
                                type="text"
                                className="form-input"
                                placeholder="Search by name, brand, location, or department..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                    </div>

                    <div className="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Serial</th>
                                    <th>Name</th>
                                    <th>Brand</th>
                                    <th>Style</th>
                                    <th>Size</th>
                                    <th>Location</th>
                                    <th>Quantity</th>
                                    <th>Price</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredInventory.map((item) => (
                                    <tr key={item.id}>
                                        <td style={{fontFamily: 'JetBrains Mono, monospace', fontSize: '11px'}}>{item.serial}</td>
                                        <td>{item.name}</td>
                                        <td>{item.brand}</td>
                                        <td>{item.style || '-'}</td>
                                        <td>{item.size || '-'}</td>
                                        <td>{item.location}</td>
                                        <td>{item.quantity}</td>
                                        <td>${item.price?.toFixed(2)}</td>
                                        <td>
                                            {item.hasMissingParts && (
                                                <span className="badge badge-danger">Missing Parts</span>
                                            )}
                                            {item.quantity <= item.reorderPoint && !item.hasMissingParts && (
                                                <span className="badge badge-warning">Low Stock</span>
                                            )}
                                            {!item.hasMissingParts && item.quantity > item.reorderPoint && (
                                                <span className="badge badge-success">OK</span>
                                            )}
                                        </td>
                                        <td>
                                            <button 
                                                className="btn btn-icon btn-secondary" 
                                                onClick={() => printSingleLabel(item)}
                                                title="Print Label"
                                                style={{marginRight: '8px'}}
                                            >
                                                üè∑Ô∏è
                                            </button>
                                            <button className="btn btn-icon btn-secondary" onClick={() => handleEdit(item)}>
                                                ‚úèÔ∏è
                                            </button>
                                        </td>
                                    </tr>
                                ))}
                                {filteredInventory.length === 0 && (
                                    <tr>
                                        <td colSpan="10" style={{textAlign: 'center', color: 'var(--text-secondary)'}}>
                                            No items found
                                        </td>
                                    </tr>
                                )}
                            </tbody>
                        </table>
                    </div>

                    {editingItem && (
                        <div className="modal-overlay" onClick={() => setEditingItem(null)}>
                            <div className="modal" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h2 className="modal-title">Edit Item</h2>
                                    <button className="modal-close" onClick={() => setEditingItem(null)}>√ó</button>
                                </div>
                                
                                {editingItem.serial !== originalSerial && (
                                    <div className="alert alert-warning" style={{marginBottom: '20px'}}>
                                        ‚ö†Ô∏è Warning: Changing the serial number will affect barcode scanning. You may need to print a new label.
                                    </div>
                                )}
                                
                                <div className="grid grid-2">
                                    <div className="form-group">
                                        <label className="form-label">Serial Number / Barcode</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.serial}
                                            onChange={(e) => setEditingItem({...editingItem, serial: e.target.value})}
                                            style={{fontFamily: 'JetBrains Mono, monospace'}}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Name</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.name}
                                            onChange={(e) => setEditingItem({...editingItem, name: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Brand</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.brand || ''}
                                            onChange={(e) => setEditingItem({...editingItem, brand: e.target.value})}
                                            placeholder="Manufacturer/Brand"
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Style</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.style || ''}
                                            onChange={(e) => setEditingItem({...editingItem, style: e.target.value})}
                                            placeholder="Color, Type, etc."
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Size</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.size || ''}
                                            onChange={(e) => setEditingItem({...editingItem, size: e.target.value})}
                                            placeholder="Small, Large, 12in, etc."
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Quantity</label>
                                        <input
                                            type="number"
                                            className="form-input"
                                            value={editingItem.quantity}
                                            onChange={(e) => setEditingItem({...editingItem, quantity: parseInt(e.target.value)})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Location</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.location || ''}
                                            onChange={(e) => setEditingItem({...editingItem, location: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Bin Location</label>
                                        <input
                                            type="text"
                                            className="form-input"
                                            value={editingItem.binLocation || ''}
                                            onChange={(e) => setEditingItem({...editingItem, binLocation: e.target.value})}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Has Missing Parts?</label>
                                        <select
                                            className="form-input"
                                            value={editingItem.hasMissingParts ? 'yes' : 'no'}
                                            onChange={(e) => setEditingItem({...editingItem, hasMissingParts: e.target.value === 'yes'})}
                                        >
                                            <option value="no">No</option>
                                            <option value="yes">Yes</option>
                                        </select>
                                    </div>
                                    {editingItem.hasMissingParts && (
                                        <div className="form-group" style={{gridColumn: '1 / -1'}}>
                                            <label className="form-label">Missing Parts Notes</label>
                                            <textarea
                                                className="form-textarea"
                                                value={editingItem.missingPartsNotes || ''}
                                                onChange={(e) => setEditingItem({...editingItem, missingPartsNotes: e.target.value})}
                                                placeholder="Describe what parts are missing..."
                                                rows="3"
                                            />
                                        </div>
                                    )}
                                </div>
                                <div className="action-buttons">
                                    <button className="btn btn-primary" onClick={handleSaveEdit}>
                                        üíæ Save Changes
                                    </button>
                                    <button 
                                        className="btn btn-secondary" 
                                        onClick={() => printSingleLabel(editingItem)}
                                        style={{background: 'var(--accent-secondary)', borderColor: 'var(--accent-secondary)'}}
                                    >
                                        üè∑Ô∏è Print Label
                                    </button>
                                    <button className="btn btn-danger" onClick={async () => {
                                        if (confirm('Are you sure you want to delete this item?')) {
                                            await onDeleteItem(editingItem.id);
                                            setEditingItem(null);
                                        }
                                    }}>
                                        üóëÔ∏è Delete
                                    </button>
                                    <button className="btn btn-secondary" onClick={() => setEditingItem(null)}>
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ============================================
        // REPORTS COMPONENT WITH PRINT
        // ============================================
        function Reports({ inventory, pickOrders }) {
            const [reportType, setReportType] = useState('summary');

            const handlePrint = () => {
                window.print();
            };

            const completedOrders = pickOrders.filter(o => o.status === 'completed');

            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Reports</h1>
                        <p className="page-subtitle">Analytics, insights, and fulfillment reports</p>
                    </div>

                    <div className="card">
                        <div className="card-header">
                            <h2 className="card-title">Report Type</h2>
                        </div>
                        <div className="scanner-options">
                            <div 
                                className={`scanner-btn ${reportType === 'summary' ? 'active' : ''}`}
                                onClick={() => setReportType('summary')}
                            >
                                <div className="scanner-icon">üìä</div>
                                <div className="scanner-label">Summary</div>
                            </div>
                            <div 
                                className={`scanner-btn ${reportType === 'fulfillment' ? 'active' : ''}`}
                                onClick={() => setReportType('fulfillment')}
                            >
                                <div className="scanner-icon">üì¶</div>
                                <div className="scanner-label">Fulfillment</div>
                            </div>
                            <div 
                                className={`scanner-btn ${reportType === 'lowstock' ? 'active' : ''}`}
                                onClick={() => setReportType('lowstock')}
                            >
                                <div className="scanner-icon">‚ö†Ô∏è</div>
                                <div className="scanner-label">Low Stock</div>
                            </div>
                        </div>
                    </div>

                    {reportType === 'fulfillment' && (
                        <div>
                            <div className="card">
                                <div className="card-header">
                                    <h2 className="card-title">Completed Orders ({completedOrders.length})</h2>
                                    <button className="btn btn-secondary" onClick={handlePrint}>
                                        üñ®Ô∏è Print Report
                                    </button>
                                </div>
                            </div>

                            {completedOrders.map(order => (
                                <div key={order.id} className="card">
                                    <div className="card-header">
                                        <div>
                                            <h3 className="card-title">{order.name}</h3>
                                            <div style={{fontSize: '12px', color: 'var(--text-secondary)'}}>
                                                Completed by {order.completedBy} ‚Ä¢ {formatDate(order.completedAt)}
                                            </div>
                                            {order.poNumber && (
                                                <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '8px'}}>
                                                    <strong>PO #:</strong> {order.poNumber}
                                                </div>
                                            )}
                                            {order.address && (
                                                <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '4px'}}>
                                                    <strong>Ship To:</strong> {order.address}
                                                </div>
                                            )}
                                            {order.contact && (
                                                <div style={{fontSize: '13px', color: 'var(--text-primary)', marginTop: '4px'}}>
                                                    <strong>Contact:</strong> {order.contact}
                                                </div>
                                            )}
                                        </div>
                                        <span className="badge badge-success">‚úì Complete</span>
                                    </div>
                                    <div className="table-container">
                                        <table>
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Qty Needed</th>
                                                    <th>Qty Picked</th>
                                                    <th>Location</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {order.items.map(item => (
                                                    <tr key={item.id}>
                                                        <td>{item.name}</td>
                                                        <td>{item.quantityNeeded}</td>
                                                        <td>{item.quantityPicked}</td>
                                                        <td>{item.inventoryItem?.location || 'N/A'}</td>
                                                        <td>
                                                            {item.quantityPicked >= item.quantityNeeded ? (
                                                                <span className="badge badge-success">‚úì Fulfilled</span>
                                                            ) : (
                                                                <span className="badge badge-warning">Partial</span>
                                                            )}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            ))}

                            {completedOrders.length === 0 && (
                                <div className="card">
                                    <div style={{textAlign: 'center', padding: '40px', color: 'var(--text-secondary)'}}>
                                        No completed orders yet
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {reportType === 'summary' && (
                        <div className="grid grid-4">
                            <div className="stat-card">
                                <div className="stat-value">{inventory.length}</div>
                                <div className="stat-label">Total Items</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">${inventory.reduce((sum, item) => sum + (item.quantity * item.price), 0).toFixed(2)}</div>
                                <div className="stat-label">Total Value</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{pickOrders.filter(o => o.status === 'completed').length}</div>
                                <div className="stat-label">Orders Completed</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{pickOrders.filter(o => o.status !== 'completed').length}</div>
                                <div className="stat-label">Active Orders</div>
                            </div>
                        </div>
                    )}

                    {reportType === 'lowstock' && (
                        <div className="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Location</th>
                                        <th>Current Qty</th>
                                        <th>Reorder Point</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {inventory.filter(item => item.quantity <= item.reorderPoint).map((item) => (
                                        <tr key={item.id}>
                                            <td>{item.name}</td>
                                            <td>{item.location}</td>
                                            <td>{item.quantity}</td>
                                            <td>{item.reorderPoint}</td>
                                            <td><span className="badge badge-warning">Needs Reorder</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>
            );
        }

        // ============================================
        // AUDIT COMPONENT (abbreviated)
        // ============================================
        function Audit({ inventory }) {
            return (
                <div>
                    <div className="page-header">
                        <h1 className="page-title">Audit Trail</h1>
                        <p className="page-subtitle">Complete history</p>
                    </div>

                    <div className="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Item</th>
                                    <th>Action</th>
                                    <th>User</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {inventory.slice().reverse().map((item) => (
                                    <tr key={item.id}>
                                        <td>{formatDate(item.timestamp)}</td>
                                        <td>{item.name}</td>
                                        <td><span className="badge badge-info">{item.mode}</span></td>
                                        <td>{item.pickedBy}</td>
                                        <td>{item.quantity}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        }

        // ============================================
        // MAIN APP COMPONENT
        // ============================================
        function App() {
            const [user, setUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [showGuideMenu, setShowGuideMenu] = useState(false);
            const [showQuickHelp, setShowQuickHelp] = useState(false);
            const [showInactivityWarning, setShowInactivityWarning] = useState(false);
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            const [inventory, setInventory] = useState([]);
            const [pickOrders, setPickOrders] = useState([]);
            const inactivityTimerRef = useRef(null);
            const warningTimerRef = useRef(null);

            // Mobile navigation handler
            const handlePageChange = (page) => {
                setCurrentPage(page);
                setMobileMenuOpen(false); // Close menu on page change
            };

            // Inactivity logout: 5 minutes with 30 second warning
            const INACTIVITY_TIMEOUT = 5 * 60 * 1000; // 5 minutes
            const WARNING_TIME = 30 * 1000; // 30 seconds before logout

            const resetInactivityTimer = () => {
                // Clear existing timers
                if (inactivityTimerRef.current) clearTimeout(inactivityTimerRef.current);
                if (warningTimerRef.current) clearTimeout(warningTimerRef.current);
                setShowInactivityWarning(false);

                if (!user) return;

                // Set warning timer (4:30 minutes)
                warningTimerRef.current = setTimeout(() => {
                    setShowInactivityWarning(true);
                }, INACTIVITY_TIMEOUT - WARNING_TIME);

                // Set logout timer (5 minutes)
                inactivityTimerRef.current = setTimeout(() => {
                    auth.signOut();
                    setShowInactivityWarning(false);
                }, INACTIVITY_TIMEOUT);
            };

            const handleUserActivity = () => {
                if (user) {
                    resetInactivityTimer();
                }
            };

            useEffect(() => {
                if (!user) return;

                // Start inactivity timer
                resetInactivityTimer();

                // Track user activity
                const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                events.forEach(event => {
                    document.addEventListener(event, handleUserActivity);
                });

                // Cleanup
                return () => {
                    events.forEach(event => {
                        document.removeEventListener(event, handleUserActivity);
                    });
                    if (inactivityTimerRef.current) clearTimeout(inactivityTimerRef.current);
                    if (warningTimerRef.current) clearTimeout(warningTimerRef.current);
                };
            }, [user]);

            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    setUser(user);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;

                const unsubscribe = db.collection('inventory')
                    .orderBy('timestamp', 'desc')
                    .onSnapshot((snapshot) => {
                        const items = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setInventory(items);
                    });

                return () => unsubscribe();
            }, [user]);

            useEffect(() => {
                if (!user) return;

                const unsubscribe = db.collection('pickOrders')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot((snapshot) => {
                        const orders = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setPickOrders(orders);
                    });

                return () => unsubscribe();
            }, [user]);

            const handleAddItem = async (item) => {
                await db.collection('inventory').add(item);
            };

            const handlePickItem = async (itemId, quantity, user) => {
                const itemRef = db.collection('inventory').doc(itemId);
                const itemDoc = await itemRef.get();
                const currentQty = itemDoc.data().quantity;
                
                await itemRef.update({
                    quantity: currentQty - quantity
                });

                await db.collection('audit').add({
                    itemId,
                    action: 'picked',
                    quantity,
                    pickedBy: user.displayName,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            };

            const handleUpdateItem = async (updatedItem) => {
                const { id, ...data } = updatedItem;
                await db.collection('inventory').doc(id).update(data);
            };

            const handleDeleteItem = async (itemId) => {
                await db.collection('inventory').doc(itemId).delete();
            };

            const handleCreatePickOrder = async (order) => {
                await db.collection('pickOrders').add(order);
            };

            const handleUpdatePickOrder = async (orderId, itemId, quantityPicked) => {
                const orderRef = db.collection('pickOrders').doc(orderId);
                const orderDoc = await orderRef.get();
                const order = orderDoc.data();

                const updatedItems = order.items.map(item => {
                    if (item.id === itemId) {
                        const newQtyPicked = item.quantityPicked + quantityPicked;
                        
                        // Update inventory
                        if (item.inventoryItem) {
                            db.collection('inventory').doc(item.inventoryItem.id).update({
                                quantity: firebase.firestore.FieldValue.increment(-quantityPicked)
                            });
                        }

                        return {
                            ...item,
                            quantityPicked: newQtyPicked
                        };
                    }
                    return item;
                });

                await orderRef.update({ items: updatedItems });
            };

            const handleLogout = async () => {
                await auth.signOut();
                setCurrentPage('dashboard');
            };

            if (loading) {
                return (
                    <div className="app-container">
                        <div className="login-screen">
                            <div className="spinner"></div>
                            <p className="text-center" style={{marginTop: '20px'}}>Loading...</p>
                        </div>
                    </div>
                );
            }

            if (!user) {
                return (
                    <div className="app-container">
                        <AuthScreen onAuthSuccess={() => {}} />
                    </div>
                );
            }

            return (
                <div className="app-container">
                    {/* Inactivity Warning Modal */}
                    {showInactivityWarning && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0, 0, 0, 0.9)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 10001
                        }}>
                            <div style={{
                                background: 'var(--bg-secondary)',
                                border: '3px solid var(--accent-warning)',
                                borderRadius: '12px',
                                padding: '40px',
                                maxWidth: '500px',
                                textAlign: 'center',
                                boxShadow: '0 0 30px rgba(255, 215, 0, 0.3)'
                            }}>
                                <div style={{fontSize: '48px', marginBottom: '20px'}}>‚ö†Ô∏è</div>
                                <h2 style={{color: 'var(--accent-warning)', marginBottom: '20px', fontSize: '24px'}}>
                                    Inactivity Warning
                                </h2>
                                <p style={{color: 'var(--text-primary)', marginBottom: '30px', fontSize: '16px', lineHeight: '1.6'}}>
                                    You will be automatically logged out in <strong style={{color: 'var(--accent-warning)'}}>30 seconds</strong> due to inactivity.
                                </p>
                                <button 
                                    onClick={() => {
                                        setShowInactivityWarning(false);
                                        resetInactivityTimer();
                                    }}
                                    style={{
                                        padding: '15px 40px',
                                        background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                                        color: 'var(--bg-primary)',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        fontWeight: 'bold',
                                        fontSize: '16px',
                                        textTransform: 'uppercase',
                                        letterSpacing: '1px'
                                    }}
                                >
                                    I'm Still Here
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Mobile Header */}
                    <div className="mobile-header">
                        <button 
                            className="mobile-menu-btn"
                            onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                        >
                            <span>{mobileMenuOpen ? '‚úï' : '‚ò∞'}</span>
                            <span>Menu</span>
                        </button>
                        <img 
                            src="https://midstateplumbing.com/wp-content/uploads/2025/01/LO.webp" 
                            alt="Logo" 
                            style={{
                                height: '40px',
                                width: 'auto'
                            }}
                        />
                        <div style={{width: '80px'}}></div>
                    </div>

                    {/* Mobile Menu Overlay */}
                    {mobileMenuOpen && (
                        <div 
                            style={{
                                position: 'fixed',
                                top: 0,
                                left: 0,
                                right: 0,
                                bottom: 0,
                                background: 'rgba(0, 0, 0, 0.5)',
                                zIndex: 999
                            }}
                            onClick={() => setMobileMenuOpen(false)}
                        />
                    )}

                    <div className="main-layout">
                        <aside className={`sidebar ${mobileMenuOpen ? 'mobile-open' : ''}`}>
                            <div className="logo" style={{textAlign: 'center', padding: '20px 0'}}>
                                <img 
                                    src="https://midstateplumbing.com/wp-content/uploads/2025/01/LO.webp" 
                                    alt="Logo" 
                                    style={{
                                        maxWidth: '150px',
                                        height: 'auto'
                                    }}
                                />
                            </div>
                            <nav className="nav-menu">
                                <div 
                                    className={`nav-item ${currentPage === 'dashboard' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('dashboard')}
                                >
                                    üìä Dashboard
                                </div>
                                <div 
                                    className={`nav-item ${currentPage === 'stock-pick' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('stock-pick')}
                                >
                                    üì¶ Stock / Pick
                                </div>
                                <div 
                                    className={`nav-item ${currentPage === 'bulk-pick' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('bulk-pick')}
                                >
                                    üìã Bulk Pick Orders
                                </div>
                                <div 
                                    className={`nav-item ${currentPage === 'inventory' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('inventory')}
                                >
                                    üìã Inventory
                                </div>
                                <div 
                                    className={`nav-item ${currentPage === 'reports' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('reports')}
                                >
                                    üìà Reports
                                </div>
                                <div 
                                    className={`nav-item ${currentPage === 'audit' ? 'active' : ''}`}
                                    onClick={() => handlePageChange('audit')}
                                >
                                    üîç Audit Trail
                                </div>
                                <div 
                                    className="nav-item external-link"
                                    onClick={() => window.open('/bulk-import.html', '_blank')}
                                    style={{marginTop: '20px', borderTop: '2px solid var(--border)', paddingTop: '20px'}}
                                >
                                    üìä Bulk Import
                                </div>
                                <div 
                                    className="nav-item external-link"
                                    onClick={() => window.open('/labels.html', '_blank')}
                                >
                                    üè∑Ô∏è Label Maker
                                </div>
                                <div 
                                    className="nav-item"
                                    onClick={() => setShowGuideMenu(!showGuideMenu)}
                                    style={{position: 'relative', cursor: 'pointer'}}
                                >
                                    üìö Help & Guides {showGuideMenu ? '‚ñº' : '‚ñ∂'}
                                </div>
                                {showGuideMenu && (
                                    <div style={{
                                        background: 'var(--bg-primary)',
                                        border: '2px solid var(--accent-primary)',
                                        borderRadius: '8px',
                                        marginLeft: '20px',
                                        marginTop: '8px',
                                        overflow: 'hidden'
                                    }}>
                                        <div 
                                            className="guide-menu-item"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                window.open('/INTEGRATION_GUIDE.md', '_blank');
                                            }}
                                        >
                                            üìñ Integration Guide
                                        </div>
                                        <div 
                                            className="guide-menu-item"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                window.open('/BULK_IMPORT_GUIDE.md', '_blank');
                                            }}
                                        >
                                            üìä Bulk Import Guide
                                        </div>
                                        <div 
                                            className="guide-menu-item"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                window.open('/SCANNER_COMPATIBILITY_GUIDE.md', '_blank');
                                            }}
                                        >
                                            üì∑ Scanner Guide
                                        </div>
                                        <div 
                                            className="guide-menu-item"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                window.open('/DEPLOYMENT_GUIDE_COMPLETE.md', '_blank');
                                            }}
                                        >
                                            üöÄ Deployment Guide
                                        </div>
                                        <div 
                                            className="guide-menu-item"
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                setShowGuideMenu(false);
                                                setShowQuickHelp(true);
                                            }}
                                        >
                                            ‚ùì Quick Help
                                        </div>
                                    </div>
                                )}
                            </nav>
                            <div className="user-info">
                                <div className="user-name">{user.displayName || user.email}</div>
                                <div className="user-role">{user.email}</div>
                                <button 
                                    className="btn btn-secondary" 
                                    style={{width: '100%', marginTop: '12px'}}
                                    onClick={handleLogout}
                                >
                                    Logout
                                </button>
                            </div>
                        </aside>
                        <main className="content">
                            {currentPage === 'dashboard' && <Dashboard inventory={inventory} pickOrders={pickOrders} />}
                            {currentPage === 'stock-pick' && (
                                <StockPick 
                                    onAddItem={handleAddItem} 
                                    onPickItem={handlePickItem}
                                    inventory={inventory}
                                    currentUser={user} 
                                />
                            )}
                            {currentPage === 'bulk-pick' && (
                                <BulkPickOrders 
                                    inventory={inventory}
                                    onCreateOrder={handleCreatePickOrder}
                                    pickOrders={pickOrders}
                                    onUpdatePickOrder={handleUpdatePickOrder}
                                    currentUser={user}
                                />
                            )}
                            {currentPage === 'inventory' && (
                                <Inventory 
                                    inventory={inventory} 
                                    onUpdateItem={handleUpdateItem}
                                    onDeleteItem={handleDeleteItem}
                                />
                            )}
                            {currentPage === 'reports' && <Reports inventory={inventory} pickOrders={pickOrders} />}
                            {currentPage === 'audit' && <Audit inventory={inventory} />}
                        </main>
                    </div>

                    {/* Quick Help Modal */}
                    {showQuickHelp && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0, 0, 0, 0.8)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 10000,
                            padding: '20px'
                        }} onClick={() => setShowQuickHelp(false)}>
                            <div style={{
                                background: 'var(--bg-secondary)',
                                border: '2px solid var(--accent-primary)',
                                borderRadius: '12px',
                                padding: '30px',
                                maxWidth: '800px',
                                maxHeight: '80vh',
                                overflow: 'auto',
                                position: 'relative'
                            }} onClick={(e) => e.stopPropagation()}>
                                <button 
                                    onClick={() => setShowQuickHelp(false)}
                                    style={{
                                        position: 'absolute',
                                        top: '15px',
                                        right: '15px',
                                        background: 'var(--accent-danger)',
                                        color: 'white',
                                        border: 'none',
                                        borderRadius: '50%',
                                        width: '30px',
                                        height: '30px',
                                        cursor: 'pointer',
                                        fontSize: '20px',
                                        fontWeight: 'bold'
                                    }}
                                >
                                    √ó
                                </button>
                                
                                <h2 style={{color: 'var(--accent-primary)', marginBottom: '20px', fontSize: '24px'}}>
                                    ‚ùì Quick Help
                                </h2>
                                
                                <div style={{lineHeight: '1.8', color: 'var(--text-primary)'}}>
                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üöÄ Getting Started</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>Dashboard:</strong> Overview of your inventory with stats and alerts<br/>
                                        <strong>Stock/Pick:</strong> Add items (Stock mode) or remove items (Pick mode)<br/>
                                        <strong>Bulk Pick Orders:</strong> Fulfill multi-item orders with CSV upload<br/>
                                        <strong>Inventory:</strong> View and edit all items<br/>
                                        <strong>Reports:</strong> Generate inventory reports and analytics
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üì¶ Adding Items</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>Single Items:</strong> Stock/Pick tab ‚Üí Select scanner ‚Üí Enter details<br/>
                                        <strong>Bulk Import:</strong> Click "Bulk Import" ‚Üí Upload CSV/Excel ‚Üí Import<br/>
                                        <strong>With Labels:</strong> Click "Label Maker" ‚Üí Create labels ‚Üí Auto-saves to inventory
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üè∑Ô∏è Using Scanners</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>USB Scanner:</strong> Plug in, focus Serial # field, scan<br/>
                                        <strong>Bluetooth:</strong> Pair device, focus field, scan<br/>
                                        <strong>WiFi Scanner:</strong> Connect to network, focus field, scan<br/>
                                        <strong>Camera:</strong> Click camera icon, point at barcode, auto-scans
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üîç Finding Items</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>Search:</strong> Type name, serial, or location in search box<br/>
                                        <strong>Filter:</strong> Use department/location filters<br/>
                                        <strong>Scan:</strong> Scan barcode to instantly find item
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üìä Tools</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>Bulk Import:</strong> Upload spreadsheet with many items<br/>
                                        <strong>Label Maker:</strong> Create barcode labels for items<br/>
                                        <strong>Reports:</strong> Export data, view analytics
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>‚ùì Common Tasks</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        <strong>Update quantity:</strong> Stock/Pick ‚Üí Scan item ‚Üí Add/remove qty<br/>
                                        <strong>Move location:</strong> Inventory ‚Üí Edit item ‚Üí Change location<br/>
                                        <strong>Check low stock:</strong> Dashboard ‚Üí View alerts or Reports tab<br/>
                                        <strong>Mark missing parts:</strong> Edit item ‚Üí Check "Has Missing Parts"
                                    </p>

                                    <h3 style={{color: 'var(--accent-secondary)', marginTop: '20px', marginBottom: '10px'}}>üìö Full Guides</h3>
                                    <p style={{marginBottom: '15px'}}>
                                        For detailed information, check the guides in the Help menu:<br/>
                                        ‚Ä¢ <strong>Integration Guide</strong> - How everything works together<br/>
                                        ‚Ä¢ <strong>Bulk Import Guide</strong> - Spreadsheet imports<br/>
                                        ‚Ä¢ <strong>Scanner Guide</strong> - Hardware compatibility<br/>
                                        ‚Ä¢ <strong>Deployment Guide</strong> - Hosting setup
                                    </p>

                                    <div style={{
                                        marginTop: '30px',
                                        padding: '15px',
                                        background: 'var(--bg-tertiary)',
                                        borderRadius: '8px',
                                        borderLeft: '4px solid var(--accent-primary)'
                                    }}>
                                        <strong style={{color: 'var(--accent-primary)'}}>üí° Pro Tip:</strong><br/>
                                        Use keyboard shortcuts: Tab to move between fields, Enter to submit forms!
                                    </div>
                                </div>

                                <button 
                                    onClick={() => setShowQuickHelp(false)}
                                    style={{
                                        marginTop: '20px',
                                        padding: '12px 24px',
                                        background: 'linear-gradient(135deg, var(--accent-primary), var(--accent-secondary))',
                                        color: 'var(--bg-primary)',
                                        border: 'none',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        fontWeight: 'bold',
                                        fontSize: '14px',
                                        textTransform: 'uppercase',
                                        letterSpacing: '0.5px'
                                    }}
                                >
                                    Got it!
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
